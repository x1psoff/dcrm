## dcrm

### –ß—Ç–æ –¥–µ–ª–∞–µ–º (–∫–æ—Ä–æ—Ç–∫–æ)
- **–ü—É—à–∏–º —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –≤ GitHub** (–±–µ–∑ `.env`, –±–µ–∑ `db.sqlite3`, –±–µ–∑ `media/uploads`).
- –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ/Ubuntu **–∫–ª–æ–Ω–∏—Ä—É–µ–º –≤ `/data`** –∏ –ø–æ–¥–Ω–∏–º–∞–µ–º —á–µ—Ä–µ–∑ Docker.

### –í–∞–∂–Ω–æ –ø—Ä–æ —Å–µ–∫—Ä–µ—Ç—ã
- –§–∞–π–ª `.env` **–Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –≤ git** (—É–∂–µ –∏—Å–∫–ª—é—á—ë–Ω –≤ `.gitignore`).
- –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ª–µ–∂–∏—Ç `env.example` ‚Äî **—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ `.env`** –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ.

### 1) –ó–∞–ª–∏—Ç—å –≤ GitHub (–ª–æ–∫–∞–ª—å–Ω–æ)
```bash
git init
git add -A
git commit -m "Initial commit"

# –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub (–ª—É—á—à–µ private) –∏ –¥–æ–±–∞–≤—å—Ç–µ remote:
git remote add origin <YOUR_GITHUB_REPO_URL>
git push -u origin main
```

### 2) –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ Ubuntu –≤ `/data`
```bash
sudo mkdir -p /data/apps
cd /data/apps
git clone <YOUR_GITHUB_REPO_URL> dcrm
cd dcrm

cp env.example .env
nano .env
```

–ú–∏–Ω–∏–º—É–º, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–æ–∏—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ `.env`:
- `SECRET_KEY` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–π)
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) `TELEGRAM_BOT_TOKEN` –µ—Å–ª–∏ –Ω—É–∂–µ–Ω tg-–±–æ—Ç
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) `RESTIC_PASSWORD` –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –±—ç–∫–∞–ø—ã (–ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º)

–ü—É—Ç–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—É–∂–µ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è `/data/apps/dcrm`):
- `DB_PATH=/data/db.sqlite3`  ‚Üí —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫–µ `/data/apps/dcrm/db.sqlite3`
- `MEDIA_ROOT=/data/media`    ‚Üí –ø–∞–ø–∫–∞ –Ω–∞ –¥–∏—Å–∫–µ `/data/apps/dcrm/media`

### 3) –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
```bash
docker compose up -d --build
```

–û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç:
- –Ω–∞–ø—Ä—è–º—É—é: `http://<server-ip>:8000`
- —á–µ—Ä–µ–∑ reverse-proxy (Traefik): `http://<server-ip>:8088`
  - HTTPS: –ø–æ—Ä—Ç `443` (—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –ª–µ–∂–∞—Ç –≤ `docker/certs`, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π TLS –∫–æ–Ω—Ñ–∏–≥ ‚Äî –≤ `docker/traefik/dynamic`)

### üöÄ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–≤–µ–± + –±–æ—Ç + –±—ç–∫–∞–ø—ã) –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ systemd:

```bash
cd /home/qwe/dcrm/docker/systemd
sudo ./install.sh
```

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞.

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É–∂–±–æ–π:**
```bash
sudo systemctl start dcrm      # –ó–∞–ø—É—Å–∫
sudo systemctl stop dcrm       # –û—Å—Ç–∞–Ω–æ–≤–∫–∞  
sudo systemctl restart dcrm    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl status dcrm     # –°—Ç–∞—Ç—É—Å
sudo journalctl -u dcrm -f     # –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docker/systemd/README.md`

### TG-–±–æ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º `bot` (–ø—Ä–æ—Ñ–∏–ª—å `bot`).
```bash
docker compose --profile bot up -d --build
docker compose logs -f --tail=100 bot
```

### –ë—ç–∫–∞–ø—ã (SQLite + media)
–ü—Ä–æ–µ–∫—Ç –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–∏—Å `backup`, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç —Å–Ω–∞–ø—à–æ—Ç—ã `db.sqlite3` –∏ `media` –≤ restic-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
- –ü–∞–ø–∫–∞ –Ω–∞ –¥–∏—Å–∫–µ: `/data/apps/dcrm/backups`
- –í–Ω—É—Ç—Ä–∏ –±—É–¥–µ—Ç repo: `/data/apps/dcrm/backups/dcrm`

–ó–∞–ø—É—Å–∫:
```bash
docker compose --profile backup up -d backup
docker compose logs -f --tail=100 backup
```

### 4) –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ (–ë–î/–∑–∞–≥—Ä—É–∑–∫–∏)
–ï—Å–ª–∏ –Ω–∞ —Å—Ç–∞—Ä–æ–π –º–∞—à–∏–Ω–µ —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –∏—Ö –Ω–∞–¥–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å:
```bash
# –ü—Ä–∏–º–µ—Ä: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ sqlite –±–∞–∑—ã
cp /–ø—É—Ç—å/–¥–æ/—Å—Ç–∞—Ä–æ–≥–æ/db.sqlite3 /data/apps/dcrm/db.sqlite3

# –ü—Ä–∏–º–µ—Ä: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
rsync -a /–ø—É—Ç—å/–¥–æ/—Å—Ç–∞—Ä–æ–≥–æ/media/uploads/ /data/apps/dcrm/media/uploads/
```


